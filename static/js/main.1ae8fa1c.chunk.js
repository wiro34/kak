(this.webpackJsonpkak=this.webpackJsonpkak||[]).push([[0],{10:function(e,t,n){e.exports={container:"RemoteCanvas_container__27ACe",userName:"RemoteCanvas_userName__11y6s",overlay:"RemoteCanvas_overlay__1kjal",overlayActive:"RemoteCanvas_overlayActive__3My-c",disconnected:"RemoteCanvas_disconnected__2Hxhu",hide:"RemoteCanvas_hide__2PV2j",eyeClosed:"RemoteCanvas_eyeClosed__1JTOJ",grayout:"RemoteCanvas_grayout__2NdEP"}},15:function(e,t,n){e.exports={container:"ToolBoard_container__2fxiY",visibleIcon:"ToolBoard_visibleIcon__1n3-N",active:"ToolBoard_active__3DA4J"}},16:function(e,t,n){e.exports={canvasAlignment:"Room_canvasAlignment__1O8SY",paintBoardWrapper:"Room_paintBoardWrapper__16REK",paintBoard:"Room_paintBoard__1NBrS",pb_draw:"Room_pb_draw__3aeOx",pb_ThLarge:"Room_pb_ThLarge__32T2V",pb_Th:"Room_pb_Th__3va4_",remoteCanvas:"Room_remoteCanvas__2-lrq"}},18:function(e,t,n){e.exports={paletteContainer:"Palette_paletteContainer__15gzz",colorPalette:"Palette_colorPalette__2si7l",currentColor:"Palette_currentColor__18fZI",brushPalette:"Palette_brushPalette___-9o7","brush-thin":"Palette_brush-thin__1LUlB","brush-normal":"Palette_brush-normal__EY6CG","brush-bold":"Palette_brush-bold__UaOUf","brush-large":"Palette_brush-large__1-eVr",current:"Palette_current__2dY0p"}},21:function(e,t,n){e.exports={container:"TopPage_container__2V69X",contentWindow:"TopPage_contentWindow__1SkQC",contentBody:"TopPage_contentBody__3qUK4",button:"TopPage_button__1tRTt",github:"TopPage_github__1ICff"}},25:function(e,t,n){e.exports={header:"RoomHeader_header__2lyGX",roomId:"RoomHeader_roomId__2-CxS",copyIcon:"RoomHeader_copyIcon__13CgJ",modeIcons:"RoomHeader_modeIcons__2hnMQ"}},30:function(e,t,n){e.exports={container:"CenteredContainer_container__3R0Hk",contentWindow:"CenteredContainer_contentWindow__14df9",contentBody:"CenteredContainer_contentBody__1L9Yc"}},31:function(e,t,n){e.exports={commandBoard:"CommandBoard_commandBoard__1duD2",commandIcon:"CommandBoard_commandIcon__3n6_y"}},37:function(e,t,n){e.exports={tooltip:"Tooltip_tooltip__1K7qB",tooltipText:"Tooltip_tooltipText__OgMCb"}},38:function(e,t,n){e.exports={longTapIcon:"LongTapRemoveIcon_longTapIcon__3klTB",smoothIcon:"LongTapRemoveIcon_smoothIcon__2WjEN"}},39:function(e,t,n){e.exports={paintBoard:"PaintBoard_paintBoard__hAH3U",tools:"PaintBoard_tools__3tTQ-"}},45:function(e,t,n){e.exports={canvas:"FixedCanvas_canvas__1pzjM"}},46:function(e,t,n){e.exports={button:"FancyButton_button__v6Va5"}},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),c=n(41),r=n.n(c),s=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,70)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),a(e),o(e),c(e),r(e)}))},i=n(34),d=n(5),u=n(19),l=n.n(u),b=n(27),j=n(3),m=n(29),f=n(6),h=n(69),O=n(21),v=n.n(O),p=n(0),x=function(){var e=Object(a.useState)(""),t=Object(j.a)(e,2),n=t[0],o=t[1],c=Object(h.a)(["nickname"]),r=Object(j.a)(c,2)[1],s=Object(a.useState)(),i=Object(j.a)(s,2),u=i[0],O=i[1],x=Object(a.useCallback)(Object(b.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.length>0&&(O(Math.random().toString(32).substring(2)),r("nickname",n));case 1:case"end":return e.stop()}}),e)}))),[n,r]);return u?Object(p.jsx)(d.a,{push:!0,to:{pathname:"/room/".concat(u),state:{mode:"createRoom"}}}):Object(p.jsxs)("div",{className:v.a.container,children:[Object(p.jsx)("div",{className:v.a.contentWindow,children:Object(p.jsxs)("main",{className:v.a.contentBody,children:[Object(p.jsx)("p",{children:"\u30d5\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u307f\u3088\u3046"}),Object(p.jsx)("div",{children:Object(p.jsx)("input",{type:"text",placeholder:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0",onChange:function(e){return o(e.target.value)}})}),Object(p.jsx)("div",{children:Object(p.jsx)("button",{className:v.a.button,onClick:x,children:"\u30eb\u30fc\u30e0\u3092\u4f5c\u6210\u3059\u308b"})}),Object(p.jsx)("div",{className:v.a.github,children:Object(p.jsx)("a",{href:"https://github.com/wiro34/kak",children:Object(p.jsx)(f.a,{icon:m.b})})})]})}),Object(p.jsx)("footer",{})]})},_=n(44),C=n(43),y=n(37),k=n.n(y),g=function(e){var t,n=e.text,a=e.onShow,o=e.onHide,c=e.children;return Object(p.jsxs)("span",{className:k.a.tooltip,onMouseEnter:a,onMouseLeave:(t=o,t?function(){setTimeout(t,300)}:t),children:[Object(p.jsx)("span",{className:k.a.tooltipText,children:n}),c]})},w=n(25),N=n.n(w),R=n(8),S=function(e){var t=e.roomId,n=e.setColumnMode,o=Object(a.useState)(!1),c=Object(j.a)(o,2),r=c[0],s=c[1];return Object(p.jsxs)("header",{className:N.a.header,children:[Object(p.jsxs)("div",{className:N.a.roomId,children:[Object(p.jsxs)("h2",{children:["\u30eb\u30fc\u30e0ID: ",t]}),Object(p.jsx)(g,{text:r?"\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f":"\u30eb\u30fc\u30e0\u3078\u306e\u62db\u5f85\u30ea\u30f3\u30af\u3092\u30b3\u30d4\u30fc\u3059\u308b",onHide:function(){return s(!1)},children:Object(p.jsx)(C.CopyToClipboard,{text:window.location.href,onCopy:function(){return s(!0)},children:Object(p.jsx)(f.a,{icon:_.a,className:N.a.copyIcon})})})]}),Object(p.jsxs)("div",{className:N.a.modeIcons,children:[Object(p.jsx)(g,{text:"\u81ea\u5206\u306e\u30d5\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3092\u62e1\u5927\u8868\u793a",children:Object(p.jsx)(f.a,{icon:m.a,onClick:function(){return n("draw")}})}),Object(p.jsx)(g,{text:"\u30dc\u30fc\u30c9\u3092\u4e26\u3079\u3066\u8868\u793a\uff08\u5927\uff09",children:Object(p.jsx)(f.a,{icon:R.g,onClick:function(){return n("th-large")}})}),Object(p.jsx)(g,{text:"\u30dc\u30fc\u30c9\u3092\u4e26\u3079\u3066\u8868\u793a\uff08\u5c0f\uff09",children:Object(p.jsx)(f.a,{icon:R.f,onClick:function(){return n("th")}})})]})]})},I=n(30),T=n.n(I),E=function(e){var t=e.children;return Object(p.jsx)("div",{className:T.a.container,children:Object(p.jsx)("div",{className:T.a.contentWindow,children:Object(p.jsx)("div",{className:T.a.contentBody,children:t})})})},B=n(13);function L(e){var t=Object(a.useRef)(e);return t.current=e,function(){return t.current&&t.current.apply(t,arguments)}}function P(){var e=[];return Object.assign((function(){e.forEach((function(e){return e()}))}),{counter:0,subscribe:function(t){e.push(t)},unsubscribe:function(t){e=e.filter((function(e){return e!==t}))}})}function J(e,t){var n=function(e){var t=Object(a.useState)(e.counter),n=Object(j.a)(t,2),o=n[0],c=n[1],r=L((function(){e.counter=o+1,c(o+1)}));return Object(a.useEffect)((function(){return e.subscribe(r),function(){return e.unsubscribe(r)}}),[]),o}(t);Object(a.useEffect)((function(){n>0&&e()}),[n])}var A=n(2),U=n(9),M=n(45),W=n.n(M),F=Object(a.forwardRef)((function(e,t){return Object(p.jsx)("div",{style:{width:"".concat(e.width,"px"),height:"".concat(e.height,"px")},children:Object(p.jsx)("canvas",Object(A.a)(Object(A.a)({},e),{},{width:"640",height:"480",ref:t,className:Object(U.a)(e.className,W.a.canvas)}))})})),D=P(),V=P(),H=function(e){var t=e.width,n=e.height,o=e.strokeStyle,c=e.initialStrokeList,r=e.onStroke,s=e.onUndo,i=e.onClear,d=Object(a.useRef)(null),u=Object(a.useState)(c),l=Object(j.a)(u,2),b=l[0],m=l[1],f=Object(a.useState)(!1),h=Object(j.a)(f,2),O=h[0],v=h[1],x=Object(a.useCallback)((function(e,t){if(d.current){var n=d.current,a=n.getContext("2d");a&&(a.fillStyle="#ffffff",a.fillRect(0,0,n.width,n.height),[].concat(Object(B.a)(e),[t]).forEach((function(e){if(e){a.strokeStyle=e.style.color.code,a.lineJoin="round",a.lineWidth=e.style.brush.width;for(var t=1;t<e.path.length;t++)a.beginPath(),a.moveTo(e.path[t-1].x,e.path[t-1].y),a.lineTo(e.path[t].x,e.path[t].y),a.closePath(),a.stroke()}})))}}),[d]),_=Object(a.useCallback)((function(){0!==b.length&&(b.pop(),m(b),s&&s(),x(b))}),[s,b,m,x]),C=Object(a.useCallback)((function(){0!==b.length&&(m([]),i&&i(),x([]))}),[i,b,m,x]);return Object(a.useEffect)((function(){if(d.current){var e=!1,t=!1,n=void 0,a=void 0,c=function(t){t.preventDefault(),e&&s(t);var c=h(t);e=!0,n=c,a={style:o,path:[c]}},s=function(t){t.preventDefault(),a&&(m([].concat(Object(B.a)(b),[a])),r&&r(a),a=void 0),e=!1},i=function(t){if(t.preventDefault(),e){var c=h(t);n&&(a&&a.path.push(c),f(o,n,c)),n=c}},u=function(o){t&&(n=h(o),a&&a.path.push(n),e=!0,t=!1)},l=function(o){e&&(n=h(o),a&&a.path.push(n),t=!0,e=!1)},j=function(e){"z"===e.key&&(e.ctrlKey||e.metaKey)&&_()},f=function(e,t,n){if(d.current){var a=d.current.getContext("2d");a&&(a.strokeStyle=e.color.code,a.lineJoin="round",a.lineWidth=e.brush.width,a.beginPath(),a.moveTo(t.x,t.y),a.lineTo(n.x,n.y),a.closePath(),a.stroke())}},h=function(e){return{x:e.offsetX,y:e.offsetY}},p=d.current;return O||(x(b),v(!0)),p.addEventListener("mousedown",c),p.addEventListener("mousemove",i),p.addEventListener("mouseup",s),p.addEventListener("mouseenter",u),p.addEventListener("mouseleave",l),p.addEventListener("keydown",j),document.addEventListener("mouseup",s),function(){p.removeEventListener("mousedown",c),p.removeEventListener("mousemove",i),p.removeEventListener("mouseup",s),p.removeEventListener("mouseenter",u),p.removeEventListener("mouseleave",l),p.removeEventListener("keydown",j),document.removeEventListener("mouseup",s)}}}),[r,s,b,m,o,_,x,O,v]),J((function(){_()}),D),J((function(){C()}),V),Object(p.jsx)(F,{tabIndex:1,width:t,height:n,ref:d})},Y=n(23),z=[{name:"thin",width:2},{name:"normal",width:6},{name:"bold",width:10},{name:"large",width:20}],K=[{name:"Bl",code:"#000000"},{name:"Gy",code:"#aaaaaa"},{name:"Wh",code:"#ffffff"},{name:"Br",code:"#03a9f4"},{name:"Gr",code:"#4caf50"},{name:"Nv",code:"#3f51b5"},{name:"Bw",code:"#795548"},{name:"Or",code:"#ff9800"},{name:"Rd",code:"#e91e63"},{name:"Yw",code:"#fbe100"},{name:"Bg",code:"#ffd8c5"},{name:"Pp",code:"#9c27b0"}],G={color:K[0],brush:z[0]};function q(e){var t=[];return e.forEach((function(e){switch(e.command){case"draw":t.push(e.stroke);break;case"undo":t.pop()}})),t}function Q(e){switch(e.command){case"draw":return["draw",e.stroke.style.brush.name,e.stroke.style.color.name,e.stroke.path.map((function(e){return"".concat(e.x,"^").concat(e.y)})).join(",")].join(",");case"undo":return"undo";default:throw new Error("Failed to stringify StrokeCommand: command=".concat(e.command))}}function X(e){var t=e.split(","),n=t.shift();switch(n){case"draw":var a=z.find((function(e){return e.name===t[0]})),o=K.find((function(e){return e.name===t[1]}));if(!a||!o)throw new Error("");return{command:n,stroke:{style:{brush:a,color:o},path:t.splice(2).map((function(e){var t=e.split("^");return{x:parseInt(t[0],10),y:parseInt(t[1],10)}}))}};case"undo":return{command:n};default:throw new Error("Failed to parse StrokeCommand: command=".concat(n))}}var Z=n(18),$=n.n(Z),ee=function(e){var t=e.changePalette,n=Object(a.useState)(G),o=Object(j.a)(n,2),c=o[0],r=o[1],s=Object(a.useCallback)((function(e){var n=K.find((function(t){return t.name===e}));if(n){var a=Object(A.a)(Object(A.a)({},c),{},{color:n});r(a),t(a)}}),[t,r,c]),i=Object(a.useCallback)((function(e){var n=z.find((function(t){return t.name===e}));if(n){var a=Object(A.a)(Object(A.a)({},c),{},{brush:n});r(a),t(a)}}),[t,r,c]);return Object(p.jsxs)("div",{className:$.a.paletteContainer,children:[Object(p.jsxs)("div",{className:$.a.colorPalette,children:[K.map((function(e){var t=e.name,n=e.code;return Object(p.jsx)("span",{style:{backgroundColor:n},onClick:function(){return s(t)}},t)})),Object(p.jsx)("span",{className:$.a.currentColor,style:{color:c.color.code},children:Object(p.jsx)(f.a,{icon:R.e})})]}),Object(p.jsx)("div",{className:$.a.brushPalette,children:z.map((function(e){var t;return Object(p.jsx)("span",{className:Object(U.a)((t={},Object(Y.a)(t,$.a["brush-".concat(e.name)],!0),Object(Y.a)(t,$.a.current,e.name===c.brush.name),t)),onClick:function(){return i(e.name)}},e.name)}))})]})};var te=function(){var e=Object(a.createContext)(void 0);return[function(){var t=Object(a.useContext)(e);if(!t)throw new Error("useCtx must be inside a Provider with a value");return t},e.Provider]}(),ne=Object(j.a)(te,2),ae=ne[0],oe=ne[1],ce=n(15),re=n.n(ce),se=function(){var e=ae(),t=e.roomState,n=t.id,o=t.users,c=e.sendChangeVisibility,r=e.sendChangeEyeClosed,s=o.find((function(e){return e.id===n})),i=Object(a.useState)(!s||s.visible),d=Object(j.a)(i,2),u=d[0],l=d[1],b=Object(a.useState)(!s||s.eyeClosed),m=Object(j.a)(b,2),h=m[0],O=m[1],v=Object(a.useCallback)((function(){l(!u),c(!u)}),[u,l,c]),x=Object(a.useCallback)((function(){O(!h),r(!h)}),[h,O,r]);return Object(p.jsxs)("div",{className:re.a.container,children:[Object(p.jsx)("span",{onClick:x,className:re.a.visibleIcon,children:Object(p.jsx)(g,{text:h?"\u8d77\u304d\u308b\uff08\u30dc\u30fc\u30c9\u3092\u898b\u308b\uff09":"\u5bdd\u308b\uff08\u307f\u3093\u306a\u306e\u30dc\u30fc\u30c9\u3092\u898b\u306a\u3044\uff09",children:h?Object(p.jsx)(f.a,{icon:R.a,className:re.a.active}):Object(p.jsx)(f.a,{icon:R.a,className:re.a.inactive})})}),Object(p.jsx)("span",{onClick:v,className:re.a.visibleIcon,children:Object(p.jsx)(g,{text:u?"\u975e\u516c\u958b\u306b\u3059\u308b":"\u516c\u958b\u3059\u308b",children:u?Object(p.jsx)(f.a,{icon:R.b,className:re.a.inactive}):Object(p.jsx)(f.a,{icon:R.c,className:re.a.active})})})]})},ie=n(31),de=n.n(ie),ue=n(38),le=n.n(ue),be=function(e){var t=e.className,n=e.onLongTap,o=Object(a.useState)(!1),c=Object(j.a)(o,2),r=c[0],s=c[1],i=Object(a.useState)(),d=Object(j.a)(i,2),u=d[0],l=d[1],b=function(){u&&clearTimeout(u),l(void 0)};return Object(p.jsx)("a",{className:Object(U.a)(t,le.a.longTapIcon),children:Object(p.jsx)("span",{className:le.a.smoothIcon,onMouseDown:function(){s(!1);var e=setTimeout((function(){s(!0)}),500);l(e)},onMouseUp:function(){r&&n(),b()},onMouseLeave:b,children:Object(p.jsx)("i",{className:"fas fa-trash"})})})},je=function(e){var t=e.onCommand;return Object(p.jsxs)("div",{className:de.a.commandBoard,children:[Object(p.jsx)("span",{onClick:function(){return t("undo")},children:Object(p.jsx)(g,{text:"\u5143\u306b\u623b\u3059\uff08Ctrl+Z\uff09",children:Object(p.jsx)(f.a,{icon:R.h,className:de.a.commandIcon})})}),Object(p.jsx)("span",{children:Object(p.jsx)(g,{text:"\u9577\u62bc\u3057\u3067\u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u30af\u30ea\u30a2\uff08\u5143\u306b\u623b\u305b\u307e\u305b\u3093\uff01\uff09",children:Object(p.jsx)(be,{className:de.a.commandIcon,onLongTap:function(){return t("clear")}})})})]})},me=n(39),fe=n.n(me),he=function(e){var t=e.className,n=ae(),o=n.roomState,c=n.sendStroke,r=n.sendClear,s=Object(a.useState)(G),i=Object(j.a)(s,2),d=i[0],u=i[1],l=Object(a.useCallback)((function(e){c({command:"draw",stroke:e})}),[c]),b=Object(a.useCallback)((function(){c({command:"undo"})}),[c]),m=Object(a.useCallback)((function(){r()}),[r]),f=o.users.find((function(e){return e.id===o.id}));return Object(p.jsxs)("div",{className:Object(U.a)(t,fe.a.paintBoard),children:[Object(p.jsx)(H,{width:640,height:480,strokeStyle:d,initialStrokeList:f?f.strokeList:[],onStroke:l,onUndo:b,onClear:m}),Object(p.jsxs)("div",{className:fe.a.tools,children:[Object(p.jsx)(ee,{changePalette:function(e){return u(e)}}),Object(p.jsx)(je,{onCommand:function(e){switch(e){case"undo":D();break;case"clear":V()}}}),Object(p.jsx)(se,{})]})]})},Oe=n(10),ve=n.n(Oe),pe=function(e){var t=e.userName,n=e.strokeList,o=e.width,c=e.height,r=e.visible,s=e.connected,i=e.eyeClosed,d=e.grayout,u=e.className,l=Object(a.useRef)(null);return Object(a.useEffect)((function(){if(l.current){var e=l.current,t=e.getContext("2d");t&&(t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),r&&n.forEach((function(e){if(e){t.strokeStyle=e.style.color.code,t.lineJoin="round",t.lineWidth=e.style.brush.width;for(var n=1;n<e.path.length;n++)t.beginPath(),t.moveTo(e.path[n-1].x,e.path[n-1].y),t.lineTo(e.path[n].x,e.path[n].y),t.closePath(),t.stroke()}})))}})),Object(p.jsxs)("div",{className:Object(U.a)(ve.a.container,u),children:[Object(p.jsx)(F,{width:o,height:c,ref:l,className:ve.a.canvas}),Object(p.jsx)("div",{className:ve.a.userName,children:t}),s?r?i?Object(p.jsx)("div",{className:Object(U.a)(ve.a.overlay,ve.a.overlayActive,ve.a.eyeClosed),children:Object(p.jsx)(f.a,{icon:R.a})}):d?Object(p.jsx)("div",{className:Object(U.a)(ve.a.overlay,ve.a.overlayActive,ve.a.grayout),children:Object(p.jsx)(f.a,{icon:R.d})}):void 0:Object(p.jsx)("div",{className:Object(U.a)(ve.a.overlay,ve.a.overlayActive,ve.a.hide),children:Object(p.jsx)(f.a,{icon:R.c})}):Object(p.jsx)("div",{className:Object(U.a)(ve.a.overlay,ve.a.overlayActive,ve.a.disconnected),children:Object(p.jsx)(f.a,{icon:R.i})})]})},xe=n(46),_e=n.n(xe),Ce=function(e){var t=e.children,n=e.onClick;return Object(p.jsx)("button",{className:_e.a.button,onClick:n,children:t})},ye=function(e){var t=e.onJoinButtonClicked,n=Object(a.useState)(""),o=Object(j.a)(n,2),c=o[0],r=o[1];return Object(p.jsxs)(E,{children:[Object(p.jsx)("p",{children:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5165\u529b\u3057\u3066\u30eb\u30fc\u30e0\u306b\u53c2\u52a0\u3057\u307e\u3057\u3087\u3046"}),Object(p.jsx)("div",{children:Object(p.jsx)("input",{type:"text",placeholder:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0",onChange:function(e){return r(e.target.value)}})}),Object(p.jsx)("div",{children:Object(p.jsx)(Ce,{onClick:function(){c.length>0&&t(c)},children:"\u30eb\u30fc\u30e0\u306b\u53c2\u52a0\u3059\u308b"})})]})},ke=n(47),ge=n(48),we=n(49);var Ne=function(){function e(t){Object(ke.a)(this,e),this.socketteRef=t}return Object(ge.a)(e,[{key:"sendCommand",value:function(e,t){this.socketteRef.current&&this.socketteRef.current.json({message:e,payload:t})}}]),e}(),Re=function(e){var t=Object(a.useState)({id:"",roomJoined:!1,role:"user",users:[]}),n=Object(j.a)(t,2),o=n[0],c=n[1],r=Object(a.useRef)(),s=new Ne(r),i=Object(a.useState)(!1),d=Object(j.a)(i,2),u=d[0],l=d[1],b=Object(a.useState)(),m=Object(j.a)(b,2),f=m[0],h=m[1],O={roomState:o,setRoomState:c},v=function(e,t,n){var o=n.roomState,c=n.setRoomState,r=Object(a.useRef)();return{createRoom:function(n){return e.sendCommand("createRoom",{roomId:t,nickname:n}),new Promise((function(e,t){r.current={resolve:e,reject:t}}))},recvRoomCreated:function(e){var n=e.id,a=e.users;c(Object(A.a)(Object(A.a)({},o),{},{id:n,role:"owner",users:Se(a),roomJoined:!0})),r.current&&(0,r.current.resolve)(t)},recvRoomAlreadyUsed:function(e){r.current&&(0,r.current.reject)("roomAlreadyUsed")}}}(s,e,O),p=v.createRoom,x=v.recvRoomCreated,_=v.recvRoomAlreadyUsed,C=function(e,t,n){var o=n.roomState,c=n.setRoomState,r=Object(a.useRef)();return{joinRoom:function(n){return e.sendCommand("joinRoom",{roomId:t,nickname:n}),new Promise((function(e,t){r.current={resolve:e,reject:t}}))},recvRoomJoined:function(e){var n=e.id,a=e.users;if(r.current){var o=r.current,s=o.resolve,i=o.reject,d=a.find((function(e){return e.id===n}));d?(c({id:d.id,roomJoined:!0,role:d.role,users:Se(a)}),s(t)):i("ERROR: roomJoined")}},recvNicknameAlreadyUsed:function(e){r.current&&(0,r.current.reject)("nicknameAlreadyUsed")},recvRoomNotFound:function(e){r.current&&(0,r.current.reject)("roomNotFound")},recvUserJoined:L((function(e){var t=e.user,n=o.users.filter((function(e){return e.id!==t.id})),a=Se([t])[0];c(Object(A.a)(Object(A.a)({},o),{},{users:[].concat(Object(B.a)(n),[Object(A.a)(Object(A.a)({},a),{},{connected:!0})])}))})),recvUserDisconnected:L((function(e){var t=e.id,n=o.users.find((function(e){return e.id===t}));if(n){var a=o.users.filter((function(e){return e.id!==t}));c(Object(A.a)(Object(A.a)({},o),{},{users:[].concat(Object(B.a)(a),[Object(A.a)(Object(A.a)({},n),{},{connected:!1})])}))}}))}}(s,e,O),y=C.joinRoom,k=C.recvRoomJoined,g=C.recvNicknameAlreadyUsed,w=C.recvRoomNotFound,N=C.recvUserJoined,R=C.recvUserDisconnected,S=function(e,t,n){var a=n.roomState,o=n.setRoomState,c=L((function(e,t){var n=a.users.find((function(t){return t.id===e}));if(n){var c=a.users.filter((function(t){return t.id!==e})),r=X(t);"draw"===r.command?n.strokeList.push(r.stroke):n.strokeList.pop(),o(Object(A.a)(Object(A.a)({},a),{},{users:[].concat(Object(B.a)(c),[Object(A.a)(Object(A.a)({},n),{},{strokeList:n.strokeList})])}))}})),r=L((function(e){var t=a.users.find((function(t){return t.id===e}));if(t){var n=a.users.filter((function(t){return t.id!==e}));o(Object(A.a)(Object(A.a)({},a),{},{users:[].concat(Object(B.a)(n),[Object(A.a)(Object(A.a)({},t),{},{strokeList:[]})])}))}})),s=L((function(e,t){var n=a.users.find((function(t){return t.id===e}));if(n){var c=a.users.filter((function(t){return t.id!==e}));o(Object(A.a)(Object(A.a)({},a),{},{users:[].concat(Object(B.a)(c),[Object(A.a)(Object(A.a)({},n),{},{visible:t})])}))}})),i=L((function(e,t){var n=a.users.find((function(t){return t.id===e}));if(n){var c=a.users.filter((function(t){return t.id!==e}));o(Object(A.a)(Object(A.a)({},a),{},{users:[].concat(Object(B.a)(c),[Object(A.a)(Object(A.a)({},n),{},{eyeClosed:t})])}))}}));return{sendStroke:function(n){var o={type:"draw",roomId:t,data:{id:a.id,strokeCommand:Q(n)}};e.sendCommand("broadcast",o)},sendClear:function(){var n={type:"clear",roomId:t,data:{id:a.id}};e.sendCommand("broadcast",n)},sendChangeVisibility:function(n){var o={type:"changeVisibility",roomId:t,data:{id:a.id,visible:n}};e.sendCommand("broadcast",o)},sendChangeEyeClosed:function(n){var c={type:"changeEyeClosed",roomId:t,data:{id:a.id,eyeClosed:n}};e.sendCommand("broadcast",c);var r=a.users.find((function(e){return e.id===a.id}));if(r){var s=a.users.filter((function(e){return e.id!==a.id}));o(Object(A.a)(Object(A.a)({},a),{},{users:[].concat(Object(B.a)(s),[Object(A.a)(Object(A.a)({},r),{},{eyeClosed:n})])}))}},recvBroadcastMessage:function(e){switch(e.type){case"draw":c(e.data.id,e.data.strokeCommand);break;case"clear":r(e.data.id);break;case"changeVisibility":s(e.data.id,e.data.visible);break;case"changeEyeClosed":i(e.data.id,e.data.eyeClosed)}}}}(s,e,O),I=S.sendStroke,T=S.sendClear,E=S.sendChangeVisibility,P=S.sendChangeEyeClosed,J=S.recvBroadcastMessage,U=function(e){switch(e.message){case"roomCreated":x(e.payload);break;case"roomAlreadyUsed":_(e.payload);break;case"roomJoined":k(e.payload);break;case"nicknameAlreadyUsed":g(e.payload);break;case"roomNotFound":w(e.payload);break;case"userJoined":N(e.payload);break;case"userDisconnected":R(e.payload);break;case"broadcast":J(e.payload)}};return Object(a.useEffect)((function(){var t=function(e,t,n,a,o){return new we.a("".concat("wss://3az66tmwr4.execute-api.us-east-2.amazonaws.com/dev","?roomId=").concat(e),{timeout:5e3,maxAttempts:3,onmessage:function(e){t(JSON.parse(e.data))},onopen:function(e){return n(e)},onclose:function(e){return a(e)},onerror:function(e){return o(e)}})}(e,U,(function(e){l(!0),r.current=t}),(function(e){l(!1),r.current=void 0}),(function(e){l(!1),h(e),console.error(e)}));return function(){r.current&&(r.current.close(),r.current=void 0),c({roomJoined:!1,id:"",role:"user",users:[]})}}),[]),{connected:u,error:f,roomState:o,createRoom:p,joinRoom:y,sendStroke:I,sendClear:T,sendChangeVisibility:E,sendChangeEyeClosed:P}};function Se(e){return e.map((function(e){return{id:e.id,nickname:e.nickname,role:e.role,strokeList:q(e.strokeList.map((function(e){return X(e)}))),visible:e.visible,eyeClosed:e.eyeClosed,connected:e.connected}}))}var Ie=n(16),Te=n.n(Ie),Ee=function(e){var t=e.match,n=e.location,o=t.params.roomId,c=Object(h.a)(["nickname"]),r=Object(j.a)(c,2),s=r[0],i=r[1],u=Object(a.useState)(s.nickname),m=Object(j.a)(u,2),f=m[0],O=m[1],v=Object(a.useState)("draw"),x=Object(j.a)(v,2),_=x[0],C=x[1],y=Object(a.useState)(),k=Object(j.a)(y,2),g=k[0],w=k[1],N=Re(o),R=N.connected,I=N.error,T=N.roomState,B=T.id,L=T.roomJoined,P=T.users,J=N.createRoom,A=N.joinRoom;if(Object(a.useEffect)((function(){R&&f&&!L&&Object(b.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n.state||"createRoom"!==n.state.mode){e.next=6;break}return e.next=4,J(f);case 4:e.next=8;break;case 6:return e.next=8,A(f);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"roomAlreadyUsed"===e.t0?w("\u30eb\u30fc\u30e0\u3092\u4f5c\u6210\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"):"roomNotFound"===e.t0?w("\u30eb\u30fc\u30e0\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f"):(console.error(e.t0),w("\u4e0d\u660e\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()}),[n,R,f,L,J,A,w]),!o)return Object(p.jsx)(d.a,{to:"/"});if(I)return Object(p.jsx)(E,{children:Object(p.jsx)("p",{children:I})});if(g)return Object(p.jsx)(E,{children:Object(p.jsx)("p",{children:g})});if(!f){return Object(p.jsx)(ye,{onJoinButtonClicked:function(e){O(e),i("nickname",e)}})}if(!L)return Object(p.jsx)("div",{className:"notify-message",children:"\u30eb\u30fc\u30e0\u3092\u8aad\u307f\u8fbc\u307f\u4e2d\u2026"});var M=P.find((function(e){return e.id===B})),W=P.filter((function(e){return e.id!==B})),F="draw"===_?.5:"th-large"===_?.875:.625,D=640*F,V=480*F,H="draw"===_?Te.a.pb_draw:"th-large"===_?Te.a.pb_ThLarge:Te.a.pb_Th,Y=!!M&&M.eyeClosed;return Object(p.jsxs)(oe,{value:N,children:[Object(p.jsx)(S,{roomId:o,setColumnMode:C}),Object(p.jsxs)("main",{className:Te.a.canvasAlignment,children:[Object(p.jsx)("div",{className:Object(U.a)(Te.a.paintBoardWrapper,H),children:Object(p.jsx)(he,{className:Te.a.paintBoard})}),W.map((function(e){return Object(p.jsx)("div",{className:Te.a.remoteCanvas,style:{width:D,height:V},children:Object(p.jsx)(pe,{userName:e.nickname,strokeList:e.strokeList,width:D,height:V,visible:e.visible,eyeClosed:e.eyeClosed,grayout:Y,connected:e.connected},e.nickname)},e.nickname)}))]})]})},Be="/",Le="/room/:roomId",Pe=function(){return Object(p.jsx)(i.a,{basename:"/kak",children:Object(p.jsxs)(d.d,{children:[Object(p.jsx)(d.b,{exact:!0,path:Be,component:x}),Object(p.jsx)(d.b,{exact:!0,path:Le,component:Ee})]})})};n(67);r.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(Pe,{})}),document.getElementById("root")),s()}},[[68,1,2]]]);
//# sourceMappingURL=main.1ae8fa1c.chunk.js.map