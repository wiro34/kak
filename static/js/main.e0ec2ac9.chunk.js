(this.webpackJsonpkak=this.webpackJsonpkak||[]).push([[0],{14:function(e,t,n){e.exports={container:"RemoteCanvas_container__27ACe",userName:"RemoteCanvas_userName__11y6s",overlay:"RemoteCanvas_overlay__1kjal",overlayActive:"RemoteCanvas_overlayActive__3My-c",disconnected:"RemoteCanvas_disconnected__2Hxhu",hide:"RemoteCanvas_hide__2PV2j"}},15:function(e,t,n){e.exports={canvasAlignment:"Room_canvasAlignment__1O8SY",paintBoardWrapper:"Room_paintBoardWrapper__16REK",paintBoard:"Room_paintBoard__1NBrS",pb_draw:"Room_pb_draw__3aeOx",pb_ThLarge:"Room_pb_ThLarge__32T2V",pb_Th:"Room_pb_Th__3va4_",remoteCanvas:"Room_remoteCanvas__2-lrq"}},17:function(e,t,n){e.exports={paletteContainer:"Palette_paletteContainer__15gzz",colorPalette:"Palette_colorPalette__2si7l",currentColor:"Palette_currentColor__18fZI",brushPalette:"Palette_brushPalette___-9o7","brush-thin":"Palette_brush-thin__1LUlB","brush-normal":"Palette_brush-normal__EY6CG","brush-bold":"Palette_brush-bold__UaOUf","brush-large":"Palette_brush-large__1-eVr",current:"Palette_current__2dY0p"}},22:function(e,t,n){e.exports={container:"TopPage_container__2V69X",contentWindow:"TopPage_contentWindow__1SkQC",contentBody:"TopPage_contentBody__3qUK4",button:"TopPage_button__1tRTt"}},24:function(e,t,n){e.exports={header:"RoomHeader_header__2lyGX",roomId:"RoomHeader_roomId__2-CxS",copyIcon:"RoomHeader_copyIcon__13CgJ",modeIcons:"RoomHeader_modeIcons__2hnMQ"}},25:function(e,t,n){e.exports={container:"ToolBoard_container__2fxiY",visibleIcon:"ToolBoard_visibleIcon__1n3-N",active:"ToolBoard_active__3DA4J"}},29:function(e,t,n){e.exports={container:"CenteredContainer_container__3R0Hk",contentWindow:"CenteredContainer_contentWindow__14df9",contentBody:"CenteredContainer_contentBody__1L9Yc"}},30:function(e,t,n){e.exports={commandBoard:"CommandBoard_commandBoard__1duD2",commandIcon:"CommandBoard_commandIcon__3n6_y"}},37:function(e,t,n){e.exports={tooltip:"Tooltip_tooltip__1K7qB",tooltipText:"Tooltip_tooltipText__OgMCb"}},38:function(e,t,n){e.exports={longTapIcon:"LongTapRemoveIcon_longTapIcon__3klTB",smoothIcon:"LongTapRemoveIcon_smoothIcon__2WjEN"}},39:function(e,t,n){e.exports={paintBoard:"PaintBoard_paintBoard__hAH3U",tools:"PaintBoard_tools__3tTQ-"}},46:function(e,t,n){e.exports={canvas:"FixedCanvas_canvas__1pzjM"}},47:function(e,t,n){e.exports={button:"FancyButton_button__v6Va5"}},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),c=n(41),r=n.n(c),i=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,70)).then((function(t){var n=t.getCLS,o=t.getFID,a=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),o(e),a(e),c(e),r(e)}))},s=n(34),u=n(5),d=n(18),l=n.n(d),b=n(27),j=n(4),m=n(69),f=n(22),h=n.n(f),v=n(1),O=function(){var e=Object(o.useState)(""),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(m.a)(["nickname"]),r=Object(j.a)(c,2)[1],i=Object(o.useState)(),s=Object(j.a)(i,2),d=s[0],f=s[1],O=Object(u.g)(),p=Object(o.useCallback)(Object(b.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.length>0&&(f(Math.random().toString(32).substring(2)),r("nickname",n));case 1:case"end":return e.stop()}}),e)}))),[n,r,O]);return d?Object(v.jsx)(u.a,{push:!0,to:{pathname:"/room/".concat(d),state:{mode:"createRoom"}}}):Object(v.jsxs)("div",{className:h.a.container,children:[Object(v.jsx)("div",{className:h.a.contentWindow,children:Object(v.jsxs)("main",{className:h.a.contentBody,children:[Object(v.jsx)("p",{children:"\u30d5\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u307f\u3088\u3046"}),Object(v.jsx)("div",{children:Object(v.jsx)("input",{type:"text",placeholder:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0",onChange:function(e){return a(e.target.value)}})}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{className:h.a.button,onClick:p,children:"\u30eb\u30fc\u30e0\u3092\u4f5c\u6210\u3059\u308b"})})]})}),Object(v.jsx)("footer",{})]})},p=n(44),x=n(7),_=n(43),k=n(37),C=n.n(k),y=function(e){var t,n=e.text,o=e.onShow,a=e.onHide,c=e.children;return Object(v.jsxs)("span",{className:C.a.tooltip,onMouseEnter:o,onMouseLeave:(t=a,t?function(){setTimeout(t,300)}:t),children:[Object(v.jsx)("span",{className:C.a.tooltipText,children:n}),c]})},g=n(24),w=n.n(g),N=n(8),R=n(45),S=function(e){var t=e.roomId,n=e.setColumnMode,a=Object(o.useState)(!1),c=Object(j.a)(a,2),r=c[0],i=c[1];return Object(v.jsxs)("header",{className:w.a.header,children:[Object(v.jsxs)("div",{className:w.a.roomId,children:[Object(v.jsxs)("h2",{children:["\u30eb\u30fc\u30e0ID: ",t]}),Object(v.jsx)(y,{text:r?"\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f":"\u30eb\u30fc\u30e0\u3078\u306e\u62db\u5f85\u30ea\u30f3\u30af\u3092\u30b3\u30d4\u30fc\u3059\u308b",onHide:function(){return i(!1)},children:Object(v.jsx)(_.CopyToClipboard,{text:window.location.href,onCopy:function(){return i(!0)},children:Object(v.jsx)(x.a,{icon:p.a,className:w.a.copyIcon})})})]}),Object(v.jsxs)("div",{className:w.a.modeIcons,children:[Object(v.jsx)(y,{text:"\u81ea\u5206\u306e\u30d5\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3092\u62e1\u5927\u8868\u793a",children:Object(v.jsx)(x.a,{icon:R.a,onClick:function(){return n("draw")}})}),Object(v.jsx)(y,{text:"\u30dc\u30fc\u30c9\u3092\u4e26\u3079\u3066\u8868\u793a\uff08\u5927\uff09",children:Object(v.jsx)(x.a,{icon:N.e,onClick:function(){return n("th-large")}})}),Object(v.jsx)(y,{text:"\u30dc\u30fc\u30c9\u3092\u4e26\u3079\u3066\u8868\u793a\uff08\u5c0f\uff09",children:Object(v.jsx)(x.a,{icon:N.d,onClick:function(){return n("th")}})})]})]})},L=n(29),T=n.n(L),B=function(e){var t=e.children;return Object(v.jsx)("div",{className:T.a.container,children:Object(v.jsx)("div",{className:T.a.contentWindow,children:Object(v.jsx)("div",{className:T.a.contentBody,children:t})})})},I=n(13);function P(e){var t=Object(o.useRef)(e);return t.current=e,function(){return t.current&&t.current.apply(t,arguments)}}function E(){var e=[];return Object.assign((function(){e.forEach((function(e){return e()}))}),{counter:0,subscribe:function(t){e.push(t)},unsubscribe:function(t){e=e.filter((function(e){return e!==t}))}})}function J(e,t){var n=function(e){var t=Object(o.useState)(e.counter),n=Object(j.a)(t,2),a=n[0],c=n[1],r=P((function(){e.counter=a+1,c(a+1)}));return Object(o.useEffect)((function(){return e.subscribe(r),function(){return e.unsubscribe(r)}}),[]),a}(t);Object(o.useEffect)((function(){n>0&&e()}),[n])}var U=n(2),A=n(11),M=n(46),W=n.n(M),F=Object(o.forwardRef)((function(e,t){return Object(v.jsx)("div",{style:{width:"".concat(e.width,"px"),height:"".concat(e.height,"px")},children:Object(v.jsx)("canvas",Object(U.a)(Object(U.a)({},e),{},{width:"640",height:"480",ref:t,className:Object(A.a)(e.className,W.a.canvas)}))})})),D=E(),V=E(),H=function(e){var t=e.width,n=e.height,a=e.strokeStyle,c=e.initialStrokeList,r=e.onStroke,i=e.onUndo,s=e.onClear,u=Object(o.useRef)(null),d=Object(o.useState)(c),l=Object(j.a)(d,2),b=l[0],m=l[1],f=Object(o.useCallback)((function(e){if(u.current){var t=u.current,n=t.getContext("2d");n&&(n.fillStyle="#ffffff",n.fillRect(0,0,t.width,t.height),[].concat(Object(I.a)(b),[e]).forEach((function(e){if(e){n.strokeStyle=e.style.color.code,n.lineJoin="round",n.lineWidth=e.style.brush.width;for(var t=1;t<e.path.length;t++)n.beginPath(),n.moveTo(e.path[t-1].x,e.path[t-1].y),n.lineTo(e.path[t].x,e.path[t].y),n.closePath(),n.stroke()}})))}}),[b]),h=Object(o.useCallback)((function(){0!==b.length&&(b.pop(),m(b),i&&i(),f())}),[i,b,m,f]),O=Object(o.useCallback)((function(){0!==b.length&&(m([]),s&&s(),f())}),[s,m,f]);return Object(o.useEffect)((function(){if(u.current){var e=!1,t=!1,n=void 0,o=void 0,c=function(t){t.preventDefault(),e&&i(t);var c=O(t);e=!0,n=c,o={style:a,path:[c]}},i=function(t){t.preventDefault(),o&&(m([].concat(Object(I.a)(b),[o])),r&&r(o),o=void 0),e=!1},s=function(t){if(t.preventDefault(),e){var c=O(t);if(n)o&&o.path.push(c),v(a,n,c);n=c}},d=function(a){t&&(n=O(a),o&&o.path.push(n),e=!0,t=!1)},l=function(a){e&&(n=O(a),o&&o.path.push(n),t=!0,e=!1)},j=function(e){"z"===e.key&&(e.ctrlKey||e.metaKey)&&h()},v=function(e,t,n){if(u.current){var o=u.current.getContext("2d");o&&(o.strokeStyle=e.color.code,o.lineJoin="round",o.lineWidth=e.brush.width,o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(n.x,n.y),o.closePath(),o.stroke())}},O=function(e){return{x:e.offsetX,y:e.offsetY}},p=u.current;return f(),p.addEventListener("mousedown",c),p.addEventListener("mousemove",s),p.addEventListener("mouseup",i),p.addEventListener("mouseenter",d),p.addEventListener("mouseleave",l),p.addEventListener("keydown",j),document.addEventListener("mouseup",i),function(){p.removeEventListener("mousedown",c),p.removeEventListener("mousemove",s),p.removeEventListener("mouseup",i),p.removeEventListener("mouseenter",d),p.removeEventListener("mouseleave",l),p.removeEventListener("keydown",j),document.removeEventListener("mouseup",i)}}}),[r,i,b,m,a,h,f]),J((function(){h()}),D),J((function(){O()}),V),Object(v.jsx)(F,{tabIndex:1,width:t,height:n,ref:u})},Y=n(21),K=[{name:"thin",width:2},{name:"normal",width:6},{name:"bold",width:10},{name:"large",width:20}],z=[{name:"Bl",code:"#000000"},{name:"Gy",code:"#aaaaaa"},{name:"Wh",code:"#ffffff"},{name:"Br",code:"#03a9f4"},{name:"Gr",code:"#4caf50"},{name:"Nv",code:"#3f51b5"},{name:"Bw",code:"#795548"},{name:"Or",code:"#ff9800"},{name:"Rd",code:"#e91e63"},{name:"Yw",code:"#fbe100"},{name:"Bg",code:"#ffd8c5"},{name:"Pp",code:"#9c27b0"}],G={color:z[0],brush:K[0]};function q(e){var t=[];return e.forEach((function(e){switch(e.command){case"draw":t.push(e.stroke);break;case"undo":t.pop()}})),t}function Q(e){switch(e.command){case"draw":return["draw",e.stroke.style.brush.name,e.stroke.style.color.name,e.stroke.path.map((function(e){return"".concat(e.x,"^").concat(e.y)})).join(",")].join(",");case"undo":return"undo";default:throw new Error("Failed to stringify StrokeCommand: command=".concat(e.command))}}function X(e){var t=e.split(","),n=t.shift();switch(n){case"draw":var o=K.find((function(e){return e.name===t[0]})),a=z.find((function(e){return e.name===t[1]}));if(!o||!a)throw new Error("");return{command:n,stroke:{style:{brush:o,color:a},path:t.splice(2).map((function(e){var t=e.split("^");return{x:parseInt(t[0],10),y:parseInt(t[1],10)}}))}};case"undo":return{command:n};default:throw new Error("Failed to parse StrokeCommand: command=".concat(n))}}var Z=n(17),$=n.n(Z),ee=function(e){var t=e.changePalette,n=Object(o.useState)(G),a=Object(j.a)(n,2),c=a[0],r=a[1],i=Object(o.useCallback)((function(e){var n=z.find((function(t){return t.name===e}));if(n){var o=Object(U.a)(Object(U.a)({},c),{},{color:n});r(o),t(o)}}),[t,r,c]),s=Object(o.useCallback)((function(e){var n=K.find((function(t){return t.name===e}));if(n){var o=Object(U.a)(Object(U.a)({},c),{},{brush:n});r(o),t(o)}}),[t,r,c]);return Object(v.jsxs)("div",{className:$.a.paletteContainer,children:[Object(v.jsxs)("div",{className:$.a.colorPalette,children:[z.map((function(e){var t=e.name,n=e.code;return Object(v.jsx)("span",{style:{backgroundColor:n},onClick:function(){return i(t)}},t)})),Object(v.jsx)("span",{className:$.a.currentColor,style:{color:c.color.code},children:Object(v.jsx)(x.a,{icon:N.c})})]}),Object(v.jsx)("div",{className:$.a.brushPalette,children:K.map((function(e){var t;return Object(v.jsx)("span",{className:Object(A.a)((t={},Object(Y.a)(t,$.a["brush-".concat(e.name)],!0),Object(Y.a)(t,$.a.current,e.name===c.brush.name),t)),onClick:function(){return s(e.name)}},e.name)}))})]})};var te=function(){var e=Object(o.createContext)(void 0);return[function(){var t=Object(o.useContext)(e);if(!t)throw new Error("useCtx must be inside a Provider with a value");return t},e.Provider]}(),ne=Object(j.a)(te,2),oe=ne[0],ae=ne[1],ce=n(25),re=n.n(ce),ie=function(){var e,t=oe(),n=t.roomState,a=n.id,c=n.users,r=t.sendChangeVisibility,i=null===(e=c.find((function(e){return e.id===a})))||void 0===e?void 0:e.visible,s=Object(o.useState)(void 0===i||i),u=Object(j.a)(s,2),d=u[0],l=u[1],b=Object(o.useCallback)((function(){l(!d),r(!d)}),[d,l,r]);return Object(v.jsx)("div",{className:re.a.container,children:Object(v.jsx)(y,{text:d?"\u975e\u516c\u958b\u306b\u3059\u308b":"\u516c\u958b\u3059\u308b",children:Object(v.jsx)("span",{onClick:b,className:re.a.visibleIcon,children:d?Object(v.jsx)(x.a,{icon:N.a,className:re.a.inactive}):Object(v.jsx)(x.a,{icon:N.b,className:re.a.active})})})})},se=n(30),ue=n.n(se),de=n(38),le=n.n(de),be=function(e){var t=e.className,n=e.onLongTap,a=Object(o.useState)(!1),c=Object(j.a)(a,2),r=c[0],i=c[1],s=Object(o.useState)(),u=Object(j.a)(s,2),d=u[0],l=u[1],b=function(){d&&clearTimeout(d),l(void 0)};return Object(v.jsx)("a",{className:"".concat(t," ").concat(le.a.longTapIcon),children:Object(v.jsx)("span",{className:le.a.smoothIcon,onMouseDown:function(){i(!1);var e=setTimeout((function(){i(!0)}),500);l(e)},onMouseUp:function(){r&&(n(),console.log("onLongTap")),b()},onMouseLeave:b,children:Object(v.jsx)("i",{className:"fas fa-trash"})})})},je=function(e){var t=e.onCommand;return Object(v.jsxs)("div",{className:ue.a.commandBoard,children:[Object(v.jsx)("span",{onClick:function(){return t("undo")},children:Object(v.jsx)(y,{text:"\u5143\u306b\u623b\u3059\uff08Ctrl+Z\uff09",children:Object(v.jsx)(x.a,{icon:N.f,className:ue.a.commandIcon})})}),Object(v.jsx)("span",{children:Object(v.jsx)(y,{text:"\u9577\u62bc\u3057\u3067\u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u30af\u30ea\u30a2\uff08\u5143\u306b\u623b\u305b\u307e\u305b\u3093\uff01\uff09",children:Object(v.jsx)(be,{className:ue.a.commandIcon,onLongTap:function(){return t("clear")}})})})]})},me=n(39),fe=n.n(me),he=function(e){var t=e.className,n=oe(),a=n.roomState,c=n.sendStroke,r=n.sendClear,i=Object(o.useState)(G),s=Object(j.a)(i,2),u=s[0],d=s[1],l=Object(o.useCallback)((function(e){c({command:"draw",stroke:e})}),[c]),b=Object(o.useCallback)((function(){c({command:"undo"})}),[c]),m=Object(o.useCallback)((function(){r()}),[r]),f=a.users.find((function(e){return e.id===a.id}));return Object(v.jsxs)("div",{className:Object(A.a)(t,fe.a.paintBoard),children:[Object(v.jsx)(H,{width:640,height:480,strokeStyle:u,initialStrokeList:f?f.strokeList:[],onStroke:l,onUndo:b,onClear:m}),Object(v.jsxs)("div",{className:fe.a.tools,children:[Object(v.jsx)(ee,{changePalette:function(e){return d(e)}}),Object(v.jsx)(je,{onCommand:function(e){switch(e){case"undo":D();break;case"clear":V()}}}),Object(v.jsx)(ie,{})]})]})},ve=n(14),Oe=n.n(ve),pe=function(e){var t=e.userName,n=e.strokeList,a=e.width,c=e.height,r=e.visible,i=e.connected,s=e.className,u=Object(o.useRef)(null);return Object(o.useEffect)((function(){if(u.current){var e=u.current,t=e.getContext("2d");t&&(t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),r&&n.forEach((function(e){if(e){t.strokeStyle=e.style.color.code,t.lineJoin="round",t.lineWidth=e.style.brush.width;for(var n=1;n<e.path.length;n++)t.beginPath(),t.moveTo(e.path[n-1].x,e.path[n-1].y),t.lineTo(e.path[n].x,e.path[n].y),t.closePath(),t.stroke()}})))}})),Object(v.jsxs)("div",{className:Object(A.a)(Oe.a.container,s),children:[Object(v.jsx)(F,{width:a,height:c,ref:u,className:Oe.a.canvas}),Object(v.jsx)("div",{className:Oe.a.userName,children:t}),i?r?void 0:Object(v.jsx)("div",{className:Object(A.a)(Oe.a.overlay,Oe.a.overlayActive,Oe.a.hide),children:Object(v.jsx)(x.a,{icon:N.b})}):Object(v.jsx)("div",{className:Object(A.a)(Oe.a.overlay,Oe.a.overlayActive,Oe.a.disconnected),children:Object(v.jsx)(x.a,{icon:N.g})})]})},xe=n(47),_e=n.n(xe),ke=function(e){var t=e.children,n=e.onClick;return Object(v.jsx)("button",{className:_e.a.button,onClick:n,children:t})},Ce=function(e){var t=e.onJoinButtonClicked,n=Object(o.useState)(""),a=Object(j.a)(n,2),c=a[0],r=a[1];return Object(v.jsxs)(B,{children:[Object(v.jsx)("p",{children:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u3092\u5165\u529b\u3057\u3066\u30eb\u30fc\u30e0\u306b\u53c2\u52a0\u3057\u307e\u3057\u3087\u3046"}),Object(v.jsx)("div",{children:Object(v.jsx)("input",{type:"text",placeholder:"\u30cb\u30c3\u30af\u30cd\u30fc\u30e0",onChange:function(e){return r(e.target.value)}})}),Object(v.jsx)("div",{children:Object(v.jsx)(ke,{onClick:function(){c.length>0&&t(c)},children:"\u30eb\u30fc\u30e0\u306b\u53c2\u52a0\u3059\u308b"})})]})},ye=n(48),ge=n(49),we=n(50);var Ne=function(){function e(t){Object(ye.a)(this,e),this.socketteRef=t}return Object(ge.a)(e,[{key:"sendCommand",value:function(e,t){this.socketteRef.current&&this.socketteRef.current.json({message:e,payload:t})}}]),e}(),Re=function(e,t){var n=Object(o.useState)({id:"",roomJoined:!1,role:"user",users:[]}),a=Object(j.a)(n,2),c=a[0],r=a[1],i=Object(o.useRef)(),s=new Ne(i),u=Object(o.useState)(!1),d=Object(j.a)(u,2),l=d[0],b=d[1],m=Object(o.useState)(),f=Object(j.a)(m,2),h=f[0],v=f[1],O={roomState:c,setRoomState:r},p=function(e,t,n){var a=n.roomState,c=n.setRoomState,r=Object(o.useRef)();return{createRoom:function(n){return e.sendCommand("createRoom",{roomId:t,nickname:n}),new Promise((function(e,t){r.current={resolve:e,reject:t}}))},recvRoomCreated:function(e){var n=e.id,o=e.users;c(Object(U.a)(Object(U.a)({},a),{},{id:n,role:"owner",users:Se(o),roomJoined:!0})),r.current&&(0,r.current.resolve)(t)},recvRoomAlreadyUsed:function(e){r.current&&(0,r.current.reject)("roomAlreadyUsed")}}}(s,e,O),x=p.createRoom,_=p.recvRoomCreated,k=p.recvRoomAlreadyUsed,C=function(e,t,n){var a=n.roomState,c=n.setRoomState,r=Object(o.useRef)();return{joinRoom:function(n){return e.sendCommand("joinRoom",{roomId:t,nickname:n}),new Promise((function(e,t){r.current={resolve:e,reject:t}}))},recvRoomJoined:function(e){var n=e.id,o=e.users;if(r.current){var a=r.current,i=a.resolve,s=a.reject,u=o.find((function(e){return e.id===n}));u?(c({id:u.id,roomJoined:!0,role:u.role,users:Se(o)}),i(t)):s("ERROR: roomJoined")}},recvNicknameAlreadyUsed:function(e){r.current&&(0,r.current.reject)("nicknameAlreadyUsed")},recvRoomNotFound:function(e){r.current&&(0,r.current.reject)("roomNotFound")},recvUserJoined:P((function(e){var t=e.user,n=a.users.filter((function(e){return e.id!==t.id})),o=Se([t])[0];c(Object(U.a)(Object(U.a)({},a),{},{users:[].concat(Object(I.a)(n),[Object(U.a)(Object(U.a)({},o),{},{connected:!0})])}))})),recvUserDisconnected:P((function(e){var t=e.id,n=a.users.find((function(e){return e.id===t}));if(n){var o=a.users.filter((function(e){return e.id!==t}));c(Object(U.a)(Object(U.a)({},a),{},{users:[].concat(Object(I.a)(o),[Object(U.a)(Object(U.a)({},n),{},{connected:!1})])}))}}))}}(s,e,O),y=C.joinRoom,g=C.recvRoomJoined,w=C.recvNicknameAlreadyUsed,N=C.recvRoomNotFound,R=C.recvUserJoined,S=C.recvUserDisconnected,L=function(e,t,n){var o=n.roomState,a=n.setRoomState,c=P((function(e,t){var n=o.users.find((function(t){return t.id===e}));if(n){var c=o.users.filter((function(t){return t.id!==e})),r=X(t);"draw"===r.command?n.strokeList.push(r.stroke):n.strokeList.pop(),a(Object(U.a)(Object(U.a)({},o),{},{users:[].concat(Object(I.a)(c),[Object(U.a)(Object(U.a)({},n),{},{strokeList:n.strokeList})])}))}})),r=P((function(e){var t=o.users.find((function(t){return t.id===e}));if(t){var n=o.users.filter((function(t){return t.id!==e}));a(Object(U.a)(Object(U.a)({},o),{},{users:[].concat(Object(I.a)(n),[Object(U.a)(Object(U.a)({},t),{},{strokeList:[]})])}))}})),i=P((function(e,t){var n=o.users.find((function(t){return t.id===e}));if(n){var c=o.users.filter((function(t){return t.id!==e}));a(Object(U.a)(Object(U.a)({},o),{},{users:[].concat(Object(I.a)(c),[Object(U.a)(Object(U.a)({},n),{},{visible:t})])}))}}));return{sendStroke:function(n){var a={type:"draw",roomId:t,data:{id:o.id,strokeCommand:Q(n)}};e.sendCommand("broadcast",a)},sendClear:function(){var n={type:"clear",roomId:t,data:{id:o.id}};e.sendCommand("broadcast",n)},sendChangeVisibility:function(n){var a={type:"changeVisibility",roomId:t,data:{id:o.id,visible:n}};e.sendCommand("broadcast",a)},recvBroadcastMessage:function(e){switch(e.type){case"draw":c(e.data.id,e.data.strokeCommand);break;case"clear":r(e.data.id);break;case"changeVisibility":i(e.data.id,e.data.visible)}}}}(s,e,O),T=L.sendStroke,B=L.sendClear,E=L.sendChangeVisibility,J=L.recvBroadcastMessage,A=function(e){switch(e.message){case"roomCreated":_(e.payload);break;case"roomAlreadyUsed":k(e.payload);break;case"roomJoined":g(e.payload);break;case"nicknameAlreadyUsed":w(e.payload);break;case"roomNotFound":N(e.payload);break;case"userJoined":R(e.payload);break;case"userDisconnected":S(e.payload);break;case"broadcast":J(e.payload)}};return Object(o.useEffect)((function(){var t=function(e,t,n,o,a){return new we.a("".concat("ws://localhost:3001","?roomId=").concat(e),{timeout:5e3,maxAttempts:3,onmessage:function(e){t(JSON.parse(e.data))},onopen:function(e){return n(e)},onclose:function(e){return o(e)},onerror:function(e){return a(e)}})}(e,A,(function(e){b(!0),i.current=t}),(function(e){b(!1),i.current=void 0}),(function(e){b(!1),v(e),console.error(e)}));return function(){i.current&&(i.current.close(),i.current=void 0),r({roomJoined:!1,id:"",role:"user",users:[]})}}),[]),{connected:l,error:h,roomState:c,createRoom:x,joinRoom:y,sendStroke:T,sendClear:B,sendChangeVisibility:E}};function Se(e){return e.map((function(e){return{id:e.id,nickname:e.nickname,role:e.role,strokeList:q(e.strokeList.map((function(e){return X(e)}))),visible:e.visible,connected:e.connected}}))}var Le=n(15),Te=n.n(Le),Be=function(e){var t=e.match,n=e.location,a=t.params.roomId,c=Object(m.a)(["nickname"]),r=Object(j.a)(c,2),i=r[0],s=r[1],d=Object(o.useState)(i.nickname),f=Object(j.a)(d,2),h=f[0],O=f[1],p=Object(o.useState)("draw"),x=Object(j.a)(p,2),_=x[0],k=x[1],C=Object(o.useState)(),y=Object(j.a)(C,2),g=y[0],w=y[1],N=Re(a,i.nickname),R=N.connected,L=N.error,T=N.roomState,I=T.id,P=T.roomJoined,E=T.users,J=N.createRoom,U=N.joinRoom;if(Object(o.useEffect)((function(){R&&h&&!P&&Object(b.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n.state||"createRoom"!==n.state.mode){e.next=6;break}return e.next=4,J(h);case 4:e.next=8;break;case 6:return e.next=8,U(h);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),"roomAlreadyUsed"===e.t0?w("\u30eb\u30fc\u30e0\u3092\u4f5c\u6210\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"):"roomNotFound"===e.t0?w("\u30eb\u30fc\u30e0\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f"):(console.error(e.t0),w("\u4e0d\u660e\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()}),[R,h,P]),!a)return Object(v.jsx)(u.a,{to:"/"});if(L)return Object(v.jsx)(B,{children:Object(v.jsx)("p",{children:L})});if(g)return Object(v.jsx)(B,{children:Object(v.jsx)("p",{children:g})});if(!h){return Object(v.jsx)(Ce,{onJoinButtonClicked:function(e){O(e),s("nickname",e)}})}if(!P)return Object(v.jsx)("div",{className:"notify-message",children:"\u30eb\u30fc\u30e0\u3092\u8aad\u307f\u8fbc\u307f\u4e2d\u2026"});var M=E.filter((function(e){return e.id!==I})),W="draw"===_?.5:"th-large"===_?.875:.625,F=640*W,D=480*W,V="draw"===_?Te.a.pb_draw:"th-large"===_?Te.a.pb_ThLarge:Te.a.pb_Th;return Object(v.jsxs)(ae,{value:N,children:[Object(v.jsx)(S,{roomId:a,setColumnMode:k}),Object(v.jsxs)("main",{className:Te.a.canvasAlignment,children:[Object(v.jsx)("div",{className:Object(A.a)(Te.a.paintBoardWrapper,V),children:Object(v.jsx)(he,{className:Te.a.paintBoard})}),M.map((function(e){return Object(v.jsx)("div",{className:Te.a.remoteCanvas,style:{width:F,height:D},children:Object(v.jsx)(pe,{userName:e.nickname,strokeList:e.strokeList,width:F,height:D,visible:e.visible,connected:e.connected},e.nickname)},e.nickname)}))]})]})},Ie=n(33),Pe="/",Ee="/room/:roomId",Je=function(){return Object(v.jsx)(s.a,{basename:Ie.env.BASE_URL,children:Object(v.jsxs)(u.d,{children:[Object(v.jsx)(u.b,{exact:!0,path:Pe,component:O}),Object(v.jsx)(u.b,{exact:!0,path:Ee,component:Be}),Object(v.jsx)(u.a,{to:Pe})]})})};n(67);r.a.render(Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(Je,{})}),document.getElementById("root")),i()}},[[68,1,2]]]);
//# sourceMappingURL=main.e0ec2ac9.chunk.js.map